# bankapp

## Функциональность
Микросервисное приложение «Банк» — это приложение с веб-интерфейсом, которое позволяет пользователю (клиенту банка):
* регистрироваться в системе по логину и паролю (заводить аккаунт);
* класть виртуальные деньги на счёт пользователя и снимать их;
* переводить деньги на другой счёт.<br>

Приложение состоит из следующих микросервисов:
* фронта (front);
* сервиса аккаунтов (accounts);
* сервиса обналичивания денег (cash);
* сервиса перевода денег между счетами одного или двух аккаунтов (transfer);
* сервиса уведомлений (notifications).

## Фронт (front)
Фронт (front) — это веб-приложение с клиентским HTML-интерфейсом. Предоставляет следующие HTML-страницы:
* Cтраницу ввода логина/пароля:
  * поле ввода логина;
  * поле ввода пароля;
  * кнопку «Войти», при нажатии на которую происходит аутентификация/авторизация пользователя и редирект на главную страницу.
* Страницу выхода из приложения (разлогинивания) содержит ссылку, при нажатии на которую:
  * пользователь разлогинивается;
  * происходит редирект на страницу ввода логина/пароля.
* Страницу регистрации пользователя в приложении (нового аккаунта):
  * поле ввода фамилии, имени, почты, даты рождения;
  * поле ввода логина, пароля и подтверждения пароля;
  * кнопку «Зарегистрироваться», при нажатии на которую происходит проверка введённых данных и создаётся новый аккаунт с автоматической аутентификацией/авторизацией пользователя и редиректом на главную страницу.
* Главную страницу, которая доступна только после успешной аутентификации/авторизации пользователя:
  * блок настроек аккаунта состоит из: 
    * логина пользователя без возможности редактирования, но с возможностью удаления (если есть хотя бы один ненулевой счёт, то должна появляться ошибка);
    * поля ввода нового пароля и кнопки «Изменить пароль», при нажатии на которую меняется пароль пользователя (пароль должен быть непустой);
    * фамилии, имени, почты (если предполагается отправлять уведомления на почту) и даты рождения с возможностью их редактирования (должна быть предусмотрена валидация: все поля заполнены, возраст старше 18 лет);
    * списка счетов пользователя с возможностью их добавления, редактирования и удаления (у пользователя может быть не более одного счёта в определённой валюте);
    * ссылки на страницу разлогинивания;
  * блок внесения и снятия виртуальных денег состоит из:
      * текущей суммы на счёте; 
      * поля ввода суммы снятия (обязательно);
      * кнопок «Положить» и «Снять» (если сумма, которую нужно снять, больше суммы на счёте, то должна появляться ошибка);
  * блок перевода денег на счёт другого аккаунта состоит из:
    * поля выбора счёта получателя (обязательно, с поиском по аккаунту);
    * поля ввода суммы перевода (если сумма больше суммы на счёте отправления, то должна появляться ошибка);
    * кнопки, при нажатии на которую осуществляется перевод денег.

## Сервис аккаунтов (accounts)
Сервис аккаунтов хранит информацию о зарегистрированных аккаунтах и счетах в каждом из них (именно в нём хранятся логин/пароль, которые проверяются при аутентификации пользователя).
Фронт выполняет REST-запросы (в формате JSON) из блока настроек аккаунта в сервис Accounts при получении данных аккаунта и данных о счетах, их редактировании, добавлении и удалении.
В свою очередь, accounts выполняет REST-запросы (в формате JSON) в notifications.
Также в accounts приходят запросы при регистрации нового аккаунта (из формы регистрации).

## Сервис обналичивания денег (cash)
Сервис обналичивания денег осуществляет пополнение счёта или снятие денег со счёта.
Фронт выполняет REST-запросы (в формате JSON) из блока внесения и снятия виртуальных денег в сервис cash.
В свою очередь, cash выполняет REST-запросы (в формате JSON) в accounts (нотификация notifications из accounts).

## Сервис перевода денег между счетами (transfer)
Сервис перевода денег между счетами осуществляет перевод денег между счетами одного пользователя и между счетами разных пользователей.
Фронт выполняет REST-запросы (в формате JSON) из блока перевода денег между своими счетами и блока перевода денег на счёт другого аккаунта в сервис transfer.
В свою очередь, transfer выполняет REST-запросы (в формате JSON) в accounts (нотификация notifications из accounts).

## Сервис уведомлений (notifications)
Сервис уведомлений отправляет уведомления на почту пользователю о выполненном действии: 
* регистрации аккаунта, 
* удалении аккаунта, 
* переводе денег, 
* пополнении счёта, 
* снятии денег со счёта 
* и т. д.

## _Структура проекта_
> Spring Framework<br>
> Java: 21<br>
> СУБД PostgreSQL: 17.5<br>


## _Запуск приложения_

### Сборка проекта
Собрать jar сервисов:
```bash
./gradlew bootJar
```

### Запуск приложения локально

1. Запустить необходимые сервисы:
   ```bash
   # Запустить Consul
   consul agent -dev -client=0.0.0.0
   
   # Запустить PostgreSQL
   # (предполагается, что у вас установлен PostgreSQL 17.5)
   
   # Запустить Keycloak
   # (предполагается, что у вас установлен Keycloak)
   ```

2. Загрузить конфигурацию в Consul:
   ```bash
   ./load-consul-config.sh
   ```

3. Импортировать realm в Keycloak:
   ```bash
   # Импортировать realm-export.json в Keycloak
   ```

4. Запустить микросервисы в следующем порядке:
   ```bash
   java -jar notifications/build/libs/notifications-0.0.1.jar
   java -jar accounts/accounts-serv/build/libs/accounts-serv-0.0.1.jar
   java -jar cash/build/libs/cash-0.0.1.jar
   java -jar transfer/build/libs/transfer-0.0.1.jar
   java -jar front/build/libs/front-0.0.1.jar
   java -jar gateway/build/libs/gateway-0.0.1.jar
   ```

### Запуск в Docker-контейнере
```bash
docker-compose up -d --build
```